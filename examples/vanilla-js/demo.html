<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AG Grid URL Sync - Complete Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@33.3.2/dist/ag-grid-community.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/ag-grid-community@33.3.2/styles/ag-grid.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/ag-grid-community@33.3.2/styles/ag-theme-alpine.min.css"
      rel="stylesheet"
    />
    <script type="module">
      // Import our library from dist
      import { createUrlSync } from '../../dist/index.js'
      window.createUrlSync = createUrlSync
    </script>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      .header {
        background: #1976d2;
        color: white;
        padding: 20px;
        text-align: center;
      }
      .header h1 {
        margin: 0;
        font-size: 28px;
      }
      .subtitle {
        margin: 10px 0 0;
        opacity: 0.9;
        font-size: 16px;
      }
      .controls {
        padding: 20px;
        border-bottom: 1px solid #eee;
        background: #fafafa;
      }
      .control-section {
        margin-bottom: 20px;
      }
      .control-section h3 {
        margin: 0 0 10px;
        color: #333;
        font-size: 16px;
      }
      .control-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
      }
      .btn-primary {
        background: #1976d2;
        color: white;
      }
      .btn-primary:hover {
        background: #1565c0;
      }
      .btn-secondary {
        background: #f5f5f5;
        color: #333;
        border: 1px solid #ddd;
      }
      .btn-secondary:hover {
        background: #e0e0e0;
      }
      .btn-danger {
        background: #d32f2f;
        color: white;
      }
      .btn-danger:hover {
        background: #c62828;
      }
      .btn-success {
        background: #388e3c;
        color: white;
      }
      .btn-success:hover {
        background: #2e7d32;
      }
      .btn-warning {
        background: #f57c00;
        color: white;
      }
      .btn-warning:hover {
        background: #ef6c00;
      }
      .url-display {
        background: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 12px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        word-break: break-all;
        margin: 5px 0 15px 0;
        min-height: 20px;
      }
      .url-input {
        width: 100%;
        padding: 8px;
        margin: 5px 0 15px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        box-sizing: border-box;
      }
      .url-input:focus {
        outline: none;
        border-color: #1976d2;
        box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
      }
      .url-label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
        font-size: 14px;
      }
      .performance-monitor {
        background: #e8f5e8;
        border: 1px solid #4caf50;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        font-size: 12px;
      }
      .error-display {
        background: #ffebee;
        border: 1px solid #f44336;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        font-size: 12px;
        color: #d32f2f;
      }
      .hidden {
        display: none;
      }
      #myGrid {
        height: 500px;
        width: 100%;
        margin: 20px 0;
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 15px 0;
      }
      .stat-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        padding: 15px;
        text-align: center;
      }
      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #1976d2;
        margin-bottom: 5px;
      }
      .stat-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .demo-section {
        padding: 20px;
        border-bottom: 1px solid #eee;
      }
      .demo-section:last-child {
        border-bottom: none;
      }
      .scenario-btn {
        margin: 5px;
      }
      .copy-btn {
        font-size: 12px;
        padding: 4px 8px;
      }
      .url-action-btn {
        min-width: 120px;
        padding: 8px 12px;
        font-size: 14px;
        text-align: center;
        white-space: nowrap;
      }
      .mode-selector,
      .format-selector {
        display: flex;
        gap: 15px;
        margin: 10px 0;
        align-items: center;
      }
      .mode-selector label,
      .format-selector label {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
        cursor: pointer;
      }
      .mode-selector input[type='radio'],
      .format-selector input[type='radio'] {
        margin: 0;
      }
      .serialization-info {
        background: #e3f2fd;
        border: 1px solid #2196f3;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        font-size: 12px;
        color: #1976d2;
      }
      .format-disabled {
        opacity: 0.5;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîó AG Grid URL Sync - Complete Demo</h1>
        <div class="subtitle">
          Comprehensive demonstration including individual & grouped
          serialization with multiple formats
        </div>
      </div>

      <div class="controls">
        <div class="control-section">
          <h3>üìä Performance Monitor</h3>
          <div id="performanceMonitor" class="performance-monitor">
            Ready to monitor performance...
          </div>
          <div class="stats">
            <div class="stat-card">
              <div id="urlGenerationTime" class="stat-value">0ms</div>
              <div class="stat-label">URL Generation</div>
            </div>
            <div class="stat-card">
              <div id="filterApplicationTime" class="stat-value">0ms</div>
              <div class="stat-label">Filter Application</div>
            </div>
            <div class="stat-card">
              <div id="operationCount" class="stat-value">0</div>
              <div class="stat-label">Total Operations</div>
            </div>
            <div class="stat-card">
              <div id="errorCount" class="stat-value">0</div>
              <div class="stat-label">Errors</div>
            </div>
          </div>
        </div>

        <div class="control-section">
          <h3>‚öôÔ∏è Serialization Configuration</h3>
          <div class="mode-selector">
            <label><strong>Serialization Mode:</strong></label>
            <label>
              <input type="radio" name="mode" value="individual" checked />
              Individual (separate parameters)
            </label>
            <label>
              <input type="radio" name="mode" value="grouped" />
              Grouped (single parameter)
            </label>
          </div>

          <div class="format-selector format-disabled" id="formatSelector">
            <label><strong>Grouped Format:</strong></label>
            <label>
              <input type="radio" name="format" value="querystring" checked />
              QueryString
            </label>
            <label>
              <input type="radio" name="format" value="json" />
              JSON
            </label>
            <label>
              <input type="radio" name="format" value="base64" />
              Base64
            </label>
          </div>

          <div id="serializationInfo" class="serialization-info">
            <strong>Individual Mode:</strong> Each filter creates a separate URL
            parameter (e.g., ?f_name_contains=john&f_age_gt=25)
          </div>
        </div>

        <div class="control-section">
          <h3>üîó URL Sharing & Testing</h3>
          <div class="control-group">
            <button class="btn btn-success" onclick="generateShareableUrl()">
              üìã Generate Shareable URL
            </button>
            <button
              class="btn btn-secondary url-action-btn"
              onclick="copyUrlToClipboard()"
            >
              üìÑ Copy URL
            </button>
            <button
              class="btn btn-secondary url-action-btn"
              onclick="applyUrlFromInput()"
            >
              üîÑ Apply URL
            </button>
            <button
              class="btn btn-secondary url-action-btn"
              onclick="clearUrlAndRefresh()"
            >
              üßπ Clear & Refresh
            </button>
          </div>
          <div>
            <label for="urlInput" class="url-label">
              üìù URL Input (paste and apply):
            </label>
            <input
              type="text"
              id="urlInput"
              placeholder="Paste a URL here to apply its filters..."
              class="url-input"
            />
          </div>
          <div>
            <label class="url-label"> üîó Generated URL: </label>
            <div id="urlDisplay" class="url-display">
              Apply filters and click "Generate Shareable URL" to see the
              result...
            </div>
          </div>
        </div>

        <div class="control-section">
          <h3>üéØ Text Filter Scenarios</h3>
          <div class="control-group">
            <button
              class="btn btn-primary scenario-btn"
              onclick="applyScenario('sales')"
            >
              üí∞ Sales Team
            </button>
            <button
              class="btn btn-primary scenario-btn"
              onclick="applyScenario('engineering')"
            >
              ‚öôÔ∏è Engineering
            </button>
            <button
              class="btn btn-primary scenario-btn"
              onclick="applyScenario('support')"
            >
              üéß Customer Support
            </button>
            <button
              class="btn btn-primary scenario-btn"
              onclick="applyScenario('startsWithFilter')"
            >
              üöÄ Starts With 'S'
            </button>
            <button
              class="btn btn-primary scenario-btn"
              onclick="applyScenario('endsWithFilter')"
            >
              üìç Ends With 'er'
            </button>
            <button
              class="btn btn-primary scenario-btn"
              onclick="applyScenario('notContainsFilter')"
            >
              üö´ Not Contains 'a'
            </button>
          </div>
        </div>

        <div class="control-section">
          <h3>üî¢ Number Filter Scenarios</h3>
          <p style="margin: 0 0 15px; color: #666; font-size: 14px">
            Demonstrates all 9 number filter operations: equals, notEqual,
            greaterThan, greaterThanOrEqual, lessThan, lessThanOrEqual, inRange,
            blank, notBlank
          </p>
          <div class="control-group">
            <button
              class="btn btn-success scenario-btn"
              onclick="applyScenario('highSalary')"
            >
              üíé High Salary (‚â•$90K)
            </button>
            <button
              class="btn btn-success scenario-btn"
              onclick="applyScenario('midSalary')"
            >
              üí∞ Mid Salary ($60K-$90K)
            </button>
            <button
              class="btn btn-success scenario-btn"
              onclick="applyScenario('entrySalary')"
            >
              üéØ Entry Level (<$65K)
            </button>
            <button
              class="btn btn-success scenario-btn"
              onclick="applyScenario('exactSalary')"
            >
              üé™ Exact Salary ($75K)
            </button>
            <button
              class="btn btn-success scenario-btn"
              onclick="applyScenario('notEqualSalary')"
            >
              ‚ùå Not $60K
            </button>
            <button
              class="btn btn-success scenario-btn"
              onclick="applyScenario('executive')"
            >
              üëî Executive View (>$100K + Excellent)
            </button>
            <button
              class="btn btn-success scenario-btn"
              onclick="applyScenario('blankSalary')"
            >
              üï≥Ô∏è Blank Salary
            </button>
            <button
              class="btn btn-success scenario-btn"
              onclick="applyScenario('notBlankSalary')"
            >
              ‚úÖ Not Blank Salary
            </button>
            <button class="btn btn-secondary" onclick="clearAllFilters()">
              üßπ Clear All
            </button>
          </div>
        </div>

        <div class="control-section">
          <h3>üìÖ Date Filter Scenarios</h3>
          <p style="margin: 0 0 15px; color: #666; font-size: 14px">
            Demonstrates all 9 date filter operations: equals, notEqual, before,
            beforeOrEqual, after, afterOrEqual, inRange, blank, notBlank
          </p>
          <div class="control-group">
            <button
              class="btn btn-info scenario-btn"
              onclick="applyScenario('dateEquals')"
            >
              üìÖ Hired On 2021-03-15
            </button>
            <button
              class="btn btn-info scenario-btn"
              onclick="applyScenario('dateNotEqual')"
            >
              ‚ùå Not Hired On 2020-07-22
            </button>
            <button
              class="btn btn-info scenario-btn"
              onclick="applyScenario('dateBefore')"
            >
              ‚è™ Hired Before 2020-01-01
            </button>
            <button
              class="btn btn-info scenario-btn"
              onclick="applyScenario('dateBeforeEq')"
            >
              ‚èÆÔ∏è Hired On/Before 2021-09-05
            </button>
            <button
              class="btn btn-info scenario-btn"
              onclick="applyScenario('dateAfter')"
            >
              ‚è© Hired After 2022-01-01
            </button>
            <button
              class="btn btn-info scenario-btn"
              onclick="applyScenario('dateAfterEq')"
            >
              ‚è≠Ô∏è Hired On/After 2019-01-10
            </button>
            <button
              class="btn btn-info scenario-btn"
              onclick="applyScenario('dateRange')"
            >
              üîÑ Hired in 2020
            </button>
            <button
              class="btn btn-info scenario-btn"
              onclick="applyScenario('dateBlank')"
            >
              üï≥Ô∏è Hire Date Blank
            </button>
            <button
              class="btn btn-info scenario-btn"
              onclick="applyScenario('dateNotBlank')"
            >
              ‚úÖ Hire Date Not Blank
            </button>
            <button class="btn btn-secondary" onclick="clearAllFilters()">
              üßπ Clear All
            </button>
          </div>
        </div>

        <div class="control-section">
          <h3>üé≠ Mixed Filter Scenarios</h3>
          <p style="margin: 0 0 15px; color: #666; font-size: 14px">
            Demonstrates complex filtering combining both text and number
            filters
          </p>
          <div class="control-group">
            <button
              class="btn btn-warning scenario-btn"
              onclick="applyScenario('engineeringHighSalary')"
            >
              ‚öôÔ∏èüíé Engineering + High Salary
            </button>
            <button
              class="btn btn-warning scenario-btn"
              onclick="applyScenario('salesMidRange')"
            >
              üí∞üìä Sales + Mid Salary
            </button>
            <button
              class="btn btn-warning scenario-btn"
              onclick="applyScenario('managerExcellent')"
            >
              üëî‚≠ê Manager + Excellent
            </button>
            <button
              class="btn btn-warning scenario-btn"
              onclick="applyScenario('remoteHighPerformer')"
            >
              üè†üöÄ Remote + High Performer
            </button>
            <button
              class="btn btn-warning scenario-btn"
              onclick="applyScenario('newHiresSalaryRange')"
            >
              üÜïüí∞ New Hires + Salary Range
            </button>
            <button class="btn btn-secondary" onclick="clearAllFilters()">
              üßπ Clear All
            </button>
          </div>
        </div>

        <div class="control-section">
          <h3>üîÑ Grouped Serialization Testing</h3>
          <p style="margin: 0 0 15px; color: #666; font-size: 14px">
            Test format conversion and grouped URL functionality
          </p>
          <div class="control-group">
            <button
              class="btn btn-info scenario-btn"
              onclick="testFormatConversion()"
            >
              üîÑ Test Format Conversion
            </button>
            <button
              class="btn btn-info scenario-btn"
              onclick="compareFormats()"
            >
              üìä Compare All Formats
            </button>

            <button
              class="btn btn-info scenario-btn"
              onclick="testUrlDetection()"
            >
              üîç Test URL Detection
            </button>
          </div>
        </div>

        <div class="control-section">
          <h3>üß™ Error Testing</h3>
          <div class="control-group">
            <button class="btn btn-danger" onclick="testMalformedUrl()">
              ‚ùå Malformed URL
            </button>
            <button class="btn btn-danger" onclick="testInvalidFilters()">
              ‚ö†Ô∏è Invalid Filters
            </button>
            <button class="btn btn-danger" onclick="testLongValues()">
              üìè Long Values
            </button>
            <button class="btn btn-secondary" onclick="clearErrors()">
              üßπ Clear Errors
            </button>
          </div>
          <div id="errorDisplay" class="error-display hidden">
            No errors to display
          </div>
        </div>

        <div class="control-section">
          <h3>‚ö° Performance Testing</h3>
          <div class="control-group">
            <button class="btn btn-secondary" onclick="stressTest()">
              üî• Stress Test (100 ops)
            </button>
            <button class="btn btn-secondary" onclick="memoryTest()">
              üß† Memory Test
            </button>
            <button class="btn btn-secondary" onclick="rapidFilterTest()">
              ‚ö° Rapid Filter Changes
            </button>
          </div>
        </div>
      </div>

      <div class="demo-section">
        <div id="myGrid" class="ag-theme-alpine"></div>
      </div>
    </div>

    <script>
      // Sample data with realistic company information
      const sampleData = [
        {
          name: 'John Smith',
          department: 'Sales',
          position: 'Senior Account Manager',
          salary: 75000,
          location: 'New York',
          hireDate: '2021-03-15',
          performance: 'Excellent'
        },
        {
          name: 'Sarah Johnson',
          department: 'Engineering',
          position: 'Software Engineer',
          salary: 85000,
          location: 'San Francisco',
          hireDate: '2020-07-22',
          performance: 'Good'
        },
        {
          name: 'Mike Chen',
          department: 'Engineering',
          position: 'Tech Lead',
          salary: 120000,
          location: 'Seattle',
          hireDate: '2019-01-10',
          performance: 'Excellent'
        },
        {
          name: 'Emily Davis',
          department: 'Marketing',
          position: 'Marketing Manager',
          salary: 70000,
          location: 'Chicago',
          hireDate: '2021-09-05',
          performance: 'Good'
        },
        {
          name: 'Robert Wilson',
          department: 'Sales',
          position: 'Sales Director',
          salary: 110000,
          location: 'Boston',
          hireDate: '2018-12-01',
          performance: 'Excellent'
        },
        {
          name: 'Lisa Anderson',
          department: 'HR',
          position: 'HR Business Partner',
          salary: 65000,
          location: 'Austin',
          hireDate: '2020-11-18',
          performance: 'Good'
        },
        {
          name: 'David Brown',
          department: 'Engineering',
          position: 'Senior Developer',
          salary: 95000,
          location: 'San Francisco',
          hireDate: '2019-08-30',
          performance: 'Excellent'
        },
        {
          name: 'Jennifer Taylor',
          department: 'Finance',
          position: 'Financial Analyst',
          salary: 60000,
          location: 'New York',
          hireDate: '2022-02-14',
          performance: 'Good'
        },
        {
          name: 'Chris Martin',
          department: 'Support',
          position: 'Customer Success Manager',
          salary: 55000,
          location: 'Portland',
          hireDate: '2021-06-20',
          performance: 'Good'
        },
        {
          name: 'Amanda White',
          department: 'Engineering',
          position: 'Principal Engineer',
          salary: 140000,
          location: 'Seattle',
          hireDate: '2017-04-03',
          performance: 'Excellent'
        },
        {
          name: 'Kevin Lee',
          department: 'Sales',
          position: 'Account Executive',
          salary: 68000,
          location: 'Denver',
          hireDate: '2020-10-12',
          performance: 'Good'
        },
        {
          name: 'Rachel Green',
          department: 'Design',
          position: 'Senior UX Designer',
          salary: 80000,
          location: 'Los Angeles',
          hireDate: '2019-12-07',
          performance: 'Excellent'
        },
        {
          name: 'Mark Thompson',
          department: 'Operations',
          position: 'Operations Manager',
          salary: 72000,
          location: 'Phoenix',
          hireDate: '2021-01-25',
          performance: 'Good'
        },
        {
          name: 'Nicole Garcia',
          department: 'Support',
          position: 'Technical Support Lead',
          salary: 58000,
          location: 'Miami',
          hireDate: '2020-05-18',
          performance: 'Good'
        },
        {
          name: 'Steve Rodriguez',
          department: 'Engineering',
          position: 'DevOps Engineer',
          salary: 100000,
          location: 'Austin',
          hireDate: '2018-09-14',
          performance: 'Excellent'
        },
        {
          name: 'Alex Johnson',
          department: 'Intern',
          position: 'Summer Intern',
          salary: null, // For demonstrating blank filters
          location: 'Remote',
          hireDate: '2023-06-01',
          performance: 'Good'
        },
        {
          name: 'Sam Wilson',
          department: 'Contractor',
          position: 'Freelance Developer',
          salary: undefined, // For demonstrating blank filters
          location: 'Remote',
          hireDate: '2023-01-15',
          performance: 'Good'
        }
      ]

      // Grid configuration
      const gridOptions = {
        columnDefs: [
          {
            field: 'name',
            headerName: 'Name',
            filter: 'agTextColumnFilter',
            floatingFilter: true
          },
          {
            field: 'department',
            headerName: 'Department',
            filter: 'agTextColumnFilter',
            floatingFilter: true
          },
          {
            field: 'position',
            headerName: 'Position',
            filter: 'agTextColumnFilter',
            floatingFilter: true
          },
          {
            field: 'salary',
            headerName: 'Salary',
            filter: 'agNumberColumnFilter',
            floatingFilter: true
          },
          {
            field: 'location',
            headerName: 'Location',
            filter: 'agTextColumnFilter',
            floatingFilter: true
          },
          {
            field: 'hireDate',
            headerName: 'Hire Date',
            filter: 'agDateColumnFilter',
            floatingFilter: true
          },
          {
            field: 'performance',
            headerName: 'Performance',
            filter: 'agTextColumnFilter',
            floatingFilter: true
          }
        ],
        rowData: sampleData,
        theme: 'legacy', // Use legacy theming to work with CSS files
        defaultColDef: {
          resizable: true,
          sortable: true,
          flex: 1,
          minWidth: 100
        },
        onFilterChanged: updatePerformanceMonitor,
        animateRows: true
      }

      // Performance monitoring
      let performanceStats = {
        operationCount: 0,
        errorCount: 0,
        lastUrlGenerationTime: 0,
        lastFilterApplicationTime: 0
      }

      // Initialize grid and URL sync
      let gridApi
      let urlSync

      document.addEventListener('DOMContentLoaded', function () {
        // Create grid
        const gridDiv = document.querySelector('#myGrid')
        gridApi = agGrid.createGrid(gridDiv, gridOptions)

        // Wait for library to load
        setTimeout(() => {
          if (window.createUrlSync) {
            urlSync = window.createUrlSync(gridApi, {
              onParseError: error => {
                showError(`URL Parse Error: ${error.message}`)
                performanceStats.errorCount++
                updatePerformanceStats()
              }
            })

            // Apply filters from URL on page load
            try {
              urlSync.applyFromUrl()
              const filterCount = Object.keys(gridApi.getFilterModel()).length
              if (filterCount > 0) {
                showSuccess(
                  `Applied ${filterCount} filter(s) from URL on page load`
                )
                // Show the current URL in the input and display
                const currentUrl = window.location.href
                document.getElementById('urlInput').value = currentUrl
                document.getElementById('urlDisplay').textContent = currentUrl
              }
            } catch (error) {
              console.warn('Failed to apply filters from URL:', error)
            }

            // Set up event listeners for mode/format changes
            setupSerializationControls()

            updatePerformanceMonitor()
          }
        }, 100)
      })

      function updatePerformanceMonitor() {
        if (gridApi) {
          const filterCount = Object.keys(gridApi.getFilterModel()).length
          document.getElementById('performanceMonitor').textContent =
            `Grid updated. Active filters: ${filterCount}`
        }
      }

      function updatePerformanceStats() {
        document.getElementById('urlGenerationTime').textContent =
          `${performanceStats.lastUrlGenerationTime.toFixed(2)}ms`
        document.getElementById('filterApplicationTime').textContent =
          `${performanceStats.lastFilterApplicationTime.toFixed(2)}ms`
        document.getElementById('operationCount').textContent =
          performanceStats.operationCount
        document.getElementById('errorCount').textContent =
          performanceStats.errorCount
      }

      function applyScenario(scenario) {
        if (!urlSync) return

        const start = performance.now()

        try {
          let filters = {}

          switch (scenario) {
            // Text filter scenarios
            case 'sales':
              filters = {
                department: {
                  filterType: 'text',
                  type: 'equals',
                  filter: 'Sales'
                }
              }
              break
            case 'engineering':
              filters = {
                department: {
                  filterType: 'text',
                  type: 'equals',
                  filter: 'Engineering'
                },
                location: {
                  filterType: 'text',
                  type: 'contains',
                  filter: 'San'
                }
              }
              break
            case 'support':
              filters = {
                department: {
                  filterType: 'text',
                  type: 'contains',
                  filter: 'Support'
                }
              }
              break
            case 'startsWithFilter':
              filters = {
                name: {
                  filterType: 'text',
                  type: 'startsWith',
                  filter: 'S'
                }
              }
              break
            case 'endsWithFilter':
              filters = {
                position: {
                  filterType: 'text',
                  type: 'endsWith',
                  filter: 'er'
                }
              }
              break
            case 'notContainsFilter':
              filters = {
                name: {
                  filterType: 'text',
                  type: 'notContains',
                  filter: 'a'
                }
              }
              break

            // Number filter scenarios
            case 'highSalary':
              filters = {
                salary: {
                  filterType: 'number',
                  type: 'greaterThanOrEqual',
                  filter: 90000
                }
              }
              break
            case 'midSalary':
              filters = {
                salary: {
                  filterType: 'number',
                  type: 'inRange',
                  filter: 60000,
                  filterTo: 90000
                }
              }
              break
            case 'entrySalary':
              filters = {
                salary: {
                  filterType: 'number',
                  type: 'lessThan',
                  filter: 65000
                }
              }
              break
            case 'exactSalary':
              filters = {
                salary: {
                  filterType: 'number',
                  type: 'equals',
                  filter: 75000
                }
              }
              break
            case 'notEqualSalary':
              filters = {
                salary: {
                  filterType: 'number',
                  type: 'notEqual',
                  filter: 60000
                }
              }
              break
            case 'executive':
              filters = {
                salary: {
                  filterType: 'number',
                  type: 'greaterThan',
                  filter: 100000
                },
                performance: {
                  filterType: 'text',
                  type: 'equals',
                  filter: 'Excellent'
                }
              }
              break
            case 'blankSalary':
              filters = {
                salary: {
                  filterType: 'number',
                  type: 'blank',
                  filter: null
                }
              }
              break
            case 'notBlankSalary':
              filters = {
                salary: {
                  filterType: 'number',
                  type: 'notBlank',
                  filter: null
                }
              }
              break

            // Date filter scenarios
            case 'dateEquals':
              filters = {
                hireDate: {
                  filterType: 'date',
                  type: 'equals',
                  dateFrom: '2021-03-15'
                }
              }
              break
            case 'dateNotEqual':
              filters = {
                hireDate: {
                  filterType: 'date',
                  type: 'notEqual',
                  dateFrom: '2020-07-22'
                }
              }
              break
            case 'dateBefore':
              filters = {
                hireDate: {
                  filterType: 'date',
                  type: 'lessThan',
                  dateFrom: '2020-01-01'
                }
              }
              break
            case 'dateBeforeEq':
              filters = {
                hireDate: {
                  filterType: 'date',
                  type: 'lessThanOrEqual',
                  dateFrom: '2021-09-05'
                }
              }
              break
            case 'dateAfter':
              filters = {
                hireDate: {
                  filterType: 'date',
                  type: 'greaterThan',
                  dateFrom: '2022-01-01'
                }
              }
              break
            case 'dateAfterEq':
              filters = {
                hireDate: {
                  filterType: 'date',
                  type: 'greaterThanOrEqual',
                  dateFrom: '2019-01-10'
                }
              }
              break
            case 'dateRange':
              filters = {
                hireDate: {
                  filterType: 'date',
                  type: 'inRange',
                  dateFrom: '2020-01-01',
                  dateTo: '2020-12-31'
                }
              }
              break
            case 'dateBlank':
              filters = {
                hireDate: {
                  filterType: 'date',
                  type: 'blank'
                }
              }
              break
            case 'dateNotBlank':
              filters = {
                hireDate: {
                  filterType: 'date',
                  type: 'notBlank'
                }
              }
              break

            // Mixed filter scenarios
            case 'engineeringHighSalary':
              filters = {
                department: {
                  filterType: 'text',
                  type: 'equals',
                  filter: 'Engineering'
                },
                salary: {
                  filterType: 'number',
                  type: 'greaterThanOrEqual',
                  filter: 90000
                }
              }
              break
            case 'salesMidRange':
              filters = {
                department: {
                  filterType: 'text',
                  type: 'equals',
                  filter: 'Sales'
                },
                salary: {
                  filterType: 'number',
                  type: 'inRange',
                  filter: 60000,
                  filterTo: 90000
                }
              }
              break
            case 'managerExcellent':
              filters = {
                position: {
                  filterType: 'text',
                  type: 'contains',
                  filter: 'Manager'
                },
                performance: {
                  filterType: 'text',
                  type: 'equals',
                  filter: 'Excellent'
                }
              }
              break
            case 'remoteHighPerformer':
              filters = {
                location: {
                  filterType: 'text',
                  type: 'equals',
                  filter: 'Remote'
                },
                performance: {
                  filterType: 'text',
                  type: 'equals',
                  filter: 'Good'
                }
              }
              break
            case 'newHiresSalaryRange':
              filters = {
                hireDate: {
                  filterType: 'text',
                  type: 'contains',
                  filter: '2023'
                },
                salary: {
                  filterType: 'number',
                  type: 'lessThan',
                  filter: 70000
                }
              }
              break
          }

          gridApi.setFilterModel(filters)
          performanceStats.lastFilterApplicationTime = performance.now() - start
          performanceStats.operationCount++
          updatePerformanceStats()
          updatePerformanceMonitor()
        } catch (error) {
          showError(`Scenario application failed: ${error.message}`)
          performanceStats.errorCount++
          updatePerformanceStats()
        }
      }

      function generateShareableUrl() {
        if (!urlSync) return

        const start = performance.now()

        try {
          const currentUrl = urlSync.generateUrl(
            window.location.origin + window.location.pathname
          )
          document.getElementById('urlDisplay').textContent = currentUrl

          // Also populate the input field for easy editing
          document.getElementById('urlInput').value = currentUrl

          performanceStats.lastUrlGenerationTime = performance.now() - start
          performanceStats.operationCount++
          updatePerformanceStats()

          showSuccess('Shareable URL generated!')
        } catch (error) {
          showError(`URL generation failed: ${error.message}`)
          performanceStats.errorCount++
          updatePerformanceStats()
        }
      }

      function copyUrlToClipboard() {
        const urlText = document.getElementById('urlDisplay').textContent
        if (
          urlText &&
          urlText !==
            'Apply filters and click "Generate Shareable URL" to see the result...'
        ) {
          navigator.clipboard
            .writeText(urlText)
            .then(() => {
              showSuccess('URL copied to clipboard!')
            })
            .catch(err => {
              showError('Failed to copy URL to clipboard')
            })
        }
      }

      function applyUrlFromInput() {
        if (!urlSync) return

        const urlInput = document.getElementById('urlInput')
        const url = urlInput.value.trim()

        if (!url) {
          showError('Please enter a URL to apply')
          return
        }

        try {
          const start = performance.now()

          // Parse URL and extract search params
          const urlObj = new URL(url)
          const newUrl =
            window.location.origin + window.location.pathname + urlObj.search

          // Navigate to the new URL which will trigger a page refresh with the new filters
          window.location.href = newUrl
        } catch (error) {
          showError(`Failed to apply URL: ${error.message}`)
          performanceStats.errorCount++
          updatePerformanceStats()
        }
      }

      function clearUrlAndRefresh() {
        // Clear the URL and refresh the page without any search parameters
        window.location.href = window.location.origin + window.location.pathname
      }

      function clearAllFilters() {
        if (!urlSync) return

        const start = performance.now()

        try {
          urlSync.clearFilters()
          performanceStats.lastFilterApplicationTime = performance.now() - start
          performanceStats.operationCount++
          updatePerformanceStats()
          updatePerformanceMonitor()

          document.getElementById('urlDisplay').textContent =
            'Apply filters and click "Generate Shareable URL" to see the result...'
        } catch (error) {
          showError(`Clear filters failed: ${error.message}`)
          performanceStats.errorCount++
          updatePerformanceStats()
        }
      }

      function testMalformedUrl() {
        if (!urlSync) return

        try {
          urlSync.applyFromUrl('not-a-valid-url')
        } catch (error) {
          showError(`Expected error: ${error.message}`)
          performanceStats.errorCount++
          updatePerformanceStats()
        }
      }

      function testInvalidFilters() {
        if (!urlSync) return

        try {
          const invalidUrl =
            'https://example.com?f_nonexistent_invalidop=test&f__contains=empty'
          urlSync.applyFromUrl(invalidUrl)
        } catch (error) {
          showError(`Expected error: ${error.message}`)
          performanceStats.errorCount++
          updatePerformanceStats()
        }
      }

      function testLongValues() {
        if (!urlSync) return

        try {
          const longValue = 'x'.repeat(300) // Exceeds default limit
          const longUrl = `https://example.com?f_name_contains=${encodeURIComponent(longValue)}`
          urlSync.applyFromUrl(longUrl)
        } catch (error) {
          showError(`Expected error: ${error.message}`)
          performanceStats.errorCount++
          updatePerformanceStats()
        }
      }

      function stressTest() {
        const start = performance.now()
        showInfo('Running stress test with 100 operations...')

        let completed = 0
        const total = 100

        for (let i = 0; i < total; i++) {
          setTimeout(() => {
            try {
              const testUrl = `https://example.com?f_test_contains=value${i}`
              urlSync.applyFromUrl(testUrl)
              const generatedUrl = urlSync.generateUrl('https://example.com')

              completed++
              if (completed === total) {
                const duration = performance.now() - start
                showSuccess(
                  `Stress test completed! 100 operations in ${duration.toFixed(2)}ms`
                )
                performanceStats.operationCount += total
                updatePerformanceStats()
              }
            } catch (error) {
              showError(`Stress test error: ${error.message}`)
              performanceStats.errorCount++
              updatePerformanceStats()
            }
          }, i * 10) // 10ms delay between operations
        }
      }

      function memoryTest() {
        showInfo('Running memory test...')

        const initialMemory = performance.memory
          ? performance.memory.usedJSHeapSize
          : 0

        // Perform many operations
        for (let i = 0; i < 1000; i++) {
          try {
            urlSync.generateUrl(`https://example.com?iteration=${i}`)
          } catch (error) {
            // Ignore errors for this test
          }
        }

        // Force garbage collection if available
        if (window.gc) {
          window.gc()
        }

        setTimeout(() => {
          const finalMemory = performance.memory
            ? performance.memory.usedJSHeapSize
            : 0
          const memoryIncrease = finalMemory - initialMemory
          const memoryMB = (memoryIncrease / 1024 / 1024).toFixed(2)

          if (memoryIncrease < 5 * 1024 * 1024) {
            // Less than 5MB
            showSuccess(`Memory test passed! Memory increase: ${memoryMB}MB`)
          } else {
            showError(`Memory test warning! Memory increase: ${memoryMB}MB`)
          }
        }, 1000)
      }

      function rapidFilterTest() {
        const start = performance.now()
        showInfo('Testing rapid filter changes...')

        const scenarios = ['sales', 'engineering', 'executive', 'support']
        let currentScenario = 0

        const interval = setInterval(() => {
          applyScenario(scenarios[currentScenario])
          currentScenario++

          if (currentScenario >= scenarios.length) {
            clearInterval(interval)
            const duration = performance.now() - start
            showSuccess(
              `Rapid filter test completed in ${duration.toFixed(2)}ms`
            )
          }
        }, 100) // Change filters every 100ms
      }

      function clearErrors() {
        const errorDisplay = document.getElementById('errorDisplay')
        errorDisplay.classList.add('hidden')
        errorDisplay.textContent = 'No errors to display'
      }

      function showError(message) {
        const errorDisplay = document.getElementById('errorDisplay')
        errorDisplay.classList.remove('hidden')
        errorDisplay.textContent = message
        console.error(message)
      }

      function showSuccess(message) {
        const performanceMonitor = document.getElementById('performanceMonitor')
        const originalBg = performanceMonitor.style.backgroundColor
        performanceMonitor.style.backgroundColor = '#e8f5e8'
        performanceMonitor.textContent = message

        setTimeout(() => {
          performanceMonitor.style.backgroundColor = originalBg
          updatePerformanceMonitor()
        }, 3000)
      }

      function showInfo(message) {
        const performanceMonitor = document.getElementById('performanceMonitor')
        performanceMonitor.textContent = message
      }

      // Grouped Serialization Functions
      function setupSerializationControls() {
        const modeRadios = document.querySelectorAll('input[name="mode"]')
        const formatRadios = document.querySelectorAll('input[name="format"]')
        const formatSelector = document.getElementById('formatSelector')
        const serializationInfo = document.getElementById('serializationInfo')

        // Handle mode changes
        modeRadios.forEach(radio => {
          radio.addEventListener('change', () => {
            if (radio.value === 'grouped') {
              formatSelector.classList.remove('format-disabled')
              updateSerializationInfo()
            } else {
              formatSelector.classList.add('format-disabled')
              updateSerializationInfo()
            }
            reinitializeUrlSync()
          })
        })

        // Handle format changes
        formatRadios.forEach(radio => {
          radio.addEventListener('change', () => {
            updateSerializationInfo()
            reinitializeUrlSync()
          })
        })

        function updateSerializationInfo() {
          const mode = document.querySelector(
            'input[name="mode"]:checked'
          ).value
          const format = document.querySelector(
            'input[name="format"]:checked'
          ).value

          if (mode === 'individual') {
            serializationInfo.innerHTML =
              '<strong>Individual Mode:</strong> Each filter creates a separate URL parameter (e.g., ?f_name_contains=john&f_age_gt=25)'
          } else {
            let description =
              '<strong>Grouped Mode:</strong> All filters packaged into a single parameter. '
            switch (format) {
              case 'querystring':
                description +=
                  '<strong>QueryString format:</strong> URL-encoded within parameter (most compatible)'
                break
              case 'json':
                description +=
                  '<strong>JSON format:</strong> Structured JSON data (good for debugging)'
                break
              case 'base64':
                description +=
                  '<strong>Base64 format:</strong> Compact encoded format (ideal for sharing)'
                break
            }
            serializationInfo.innerHTML = description
          }
        }
      }

      function reinitializeUrlSync() {
        if (!gridApi || !window.createUrlSync) return

        const mode = document.querySelector('input[name="mode"]:checked').value
        const format = document.querySelector(
          'input[name="format"]:checked'
        ).value

        const config = {
          onParseError: error => {
            showError(`URL Parse Error: ${error.message}`)
            performanceStats.errorCount++
            updatePerformanceStats()
          }
        }

        if (mode === 'grouped') {
          config.serialization = 'grouped'
          config.format = format
          config.groupedParam = 'grid_filters'
        }

        // Preserve current filters
        const currentFilters = gridApi.getFilterModel()

        // Create new URL sync instance
        urlSync = window.createUrlSync(gridApi, config)

        // Reapply filters
        if (Object.keys(currentFilters).length > 0) {
          gridApi.setFilterModel(currentFilters)
        }

        showSuccess(
          `Switched to ${mode} mode${mode === 'grouped' ? ` with ${format} format` : ''}`
        )
      }

      function testFormatConversion() {
        if (!urlSync) return

        try {
          const mode = document.querySelector(
            'input[name="mode"]:checked'
          ).value

          if (mode === 'individual') {
            showError(
              'Format conversion requires grouped mode. Please switch to grouped mode first.'
            )
            return
          }

          // Apply a sample filter set
          const sampleFilters = {
            department: {
              filterType: 'text',
              type: 'equals',
              filter: 'Engineering'
            },
            salary: { filterType: 'number', type: 'greaterThan', filter: 75000 }
          }

          gridApi.setFilterModel(sampleFilters)

          // Test all formats
          const results = []

          if (urlSync.getFiltersAsFormat) {
            const queryString = urlSync.getFiltersAsFormat('querystring')
            const json = urlSync.getFiltersAsFormat('json')
            const base64 = urlSync.getFiltersAsFormat('base64')

            results.push(
              `QueryString: ${queryString.substring(0, 100)}${queryString.length > 100 ? '...' : ''}`
            )
            results.push(
              `JSON: ${json.substring(0, 100)}${json.length > 100 ? '...' : ''}`
            )
            results.push(
              `Base64: ${base64.substring(0, 100)}${base64.length > 100 ? '...' : ''}`
            )
          }

          showSuccess(
            `Format conversion test completed!\n${results.join('\n')}`
          )
        } catch (error) {
          showError(`Format conversion failed: ${error.message}`)
        }
      }

      function compareFormats() {
        if (!urlSync) return

        try {
          // Apply a complex filter set
          const complexFilters = {
            name: { filterType: 'text', type: 'contains', filter: 'John' },
            department: {
              filterType: 'text',
              type: 'equals',
              filter: 'Engineering'
            },
            salary: {
              filterType: 'number',
              type: 'inRange',
              filter: 80000,
              filterTo: 120000
            },
            performance: {
              filterType: 'text',
              type: 'equals',
              filter: 'Excellent'
            }
          }

          gridApi.setFilterModel(complexFilters)

          // Generate URLs in different modes/formats
          const comparisons = []

          // Individual mode
          const individualSync = window.createUrlSync(gridApi, {})
          const individualUrl = individualSync.generateUrl(
            'https://example.com'
          )
          comparisons.push(`Individual: ${individualUrl.length} chars`)

          // Grouped formats
          const formats = ['querystring', 'json', 'base64']
          formats.forEach(format => {
            const groupedSync = window.createUrlSync(gridApi, {
              serialization: 'grouped',
              format: format
            })
            const groupedUrl = groupedSync.generateUrl('https://example.com')
            comparisons.push(`Grouped ${format}: ${groupedUrl.length} chars`)
          })

          const result = `URL Length Comparison:\n${comparisons.join('\n')}\n\nBase64 is typically the most compact for complex filter sets.`
          showSuccess(result)
        } catch (error) {
          showError(`Format comparison failed: ${error.message}`)
        }
      }

      function testUrlDetection() {
        try {
          const testUrls = [
            'https://example.com?f_name_contains=john&f_age_gt=25',
            'https://example.com?grid_filters=f_name_contains%3Djohn%26f_age_gt%3D25',
            'https://example.com?grid_filters=%7B%22name%22%3A%7B%22filterType%22%3A%22text%22%7D%7D',
            'https://example.com?grid_filters=eyJuYW1lIjp7ImZpbHRlclR5cGUiOiJ0ZXh0In19'
          ]

          const results = testUrls.map((url, index) => {
            const type = [
              'Individual',
              'Grouped QueryString',
              'Grouped JSON',
              'Grouped Base64'
            ][index]
            return `${type}: ${url.length} chars`
          })

          const info = `URL Detection Test:\n${results.join('\n')}\n\nThe library automatically detects the format and applies filters accordingly.`
          showSuccess(info)
        } catch (error) {
          showError(`URL detection test failed: ${error.message}`)
        }
      }
    </script>
  </body>
</html>
