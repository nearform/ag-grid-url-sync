<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AG Grid URL Sync - Grouped Serialization Demo</title>
    <script src="https://unpkg.com/ag-grid-community@31.0.0/dist/ag-grid-community.min.js"></script>
    <script src="https://unpkg.com/ag-grid-url-sync@latest/dist/ag-grid-url-sync.umd.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/ag-grid-community@31.0.0/styles/ag-grid.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/ag-grid-community@31.0.0/styles/ag-theme-alpine.css"
    />
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .controls {
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #e9ecef;
      }
      .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 15px;
      }
      button {
        padding: 8px 16px;
        border: 1px solid #007bff;
        background: #007bff;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #0056b3;
        border-color: #0056b3;
      }
      button:disabled {
        background: #6c757d;
        border-color: #6c757d;
        cursor: not-allowed;
      }
      .url-display {
        margin-top: 15px;
        padding: 10px;
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        font-family: 'Monaco', 'Consolas', monospace;
        font-size: 12px;
        word-break: break-all;
        max-height: 100px;
        overflow-y: auto;
      }
      .format-selector {
        margin-bottom: 15px;
      }
      .format-selector label {
        margin-right: 15px;
        font-weight: 500;
      }
      .format-selector input {
        margin-right: 5px;
      }
      .mode-selector {
        margin-bottom: 15px;
      }
      .demo-info {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
        border-left: 4px solid #2196f3;
      }
      .demo-info h3 {
        margin-top: 0;
        color: #1976d2;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîó AG Grid URL Sync - Grouped Serialization Demo</h1>

      <div class="demo-info">
        <h3>What is Grouped Serialization?</h3>
        <p>
          Instead of creating separate URL parameters for each filter
          (individual mode), grouped serialization packages all filters into a
          single URL parameter. This results in cleaner URLs that are easier to
          share and manage, especially with many filters.
        </p>
        <p>
          <strong>Try it:</strong> Apply some filters below and switch between
          different modes and formats to see the difference!
        </p>
      </div>

      <div class="controls">
        <div class="mode-selector">
          <label><strong>Serialization Mode:</strong></label>
          <label
            ><input type="radio" name="mode" value="individual" checked />
            Individual (separate parameters)</label
          >
          <label
            ><input type="radio" name="mode" value="grouped" /> Grouped (single
            parameter)</label
          >
        </div>

        <div class="format-selector">
          <label><strong>Grouped Format:</strong></label>
          <label
            ><input type="radio" name="format" value="querystring" checked />
            QueryString</label
          >
          <label><input type="radio" name="format" value="json" /> JSON</label>
          <label
            ><input type="radio" name="format" value="base64" /> Base64</label
          >
        </div>

        <div class="button-group">
          <button onclick="generateUrl()">üìã Generate Shareable URL</button>
          <button onclick="applyFromUrl()">üîÑ Apply URL Filters</button>
          <button onclick="clearFilters()">üóëÔ∏è Clear All Filters</button>
          <button onclick="addSampleFilters()">üéØ Add Sample Filters</button>
          <button onclick="showFormats()">üîç Show All Formats</button>
        </div>

        <div id="urlDisplay" class="url-display">
          Apply some filters and click "Generate Shareable URL" to see the
          result...
        </div>
      </div>

      <div
        id="grid"
        class="ag-theme-alpine"
        style="height: 500px; width: 100%"
      ></div>
    </div>

    <script>
      // Sample data with mixed types
      const rowData = [
        {
          name: 'John Doe',
          department: 'Engineering',
          salary: 85000,
          age: 32,
          startDate: '2024-01-15',
          active: true
        },
        {
          name: 'Jane Smith',
          department: 'Marketing',
          salary: 70000,
          age: 28,
          startDate: '2024-02-01',
          active: true
        },
        {
          name: 'Bob Johnson',
          department: 'Engineering',
          salary: 95000,
          age: 35,
          startDate: '2023-12-10',
          active: false
        },
        {
          name: 'Alice Wilson',
          department: 'Sales',
          salary: 65000,
          age: 26,
          startDate: '2024-03-01',
          active: true
        },
        {
          name: 'Charlie Brown',
          department: 'HR',
          salary: 60000,
          age: 30,
          startDate: '2024-01-20',
          active: true
        },
        {
          name: 'Diana Prince',
          department: 'Engineering',
          salary: 105000,
          age: 40,
          startDate: '2023-11-15',
          active: true
        },
        {
          name: 'Eve Adams',
          department: 'Marketing',
          salary: 75000,
          age: 29,
          startDate: '2024-02-15',
          active: false
        },
        {
          name: 'Frank Miller',
          department: 'Sales',
          salary: 80000,
          age: 34,
          startDate: '2023-12-01',
          active: true
        }
      ]

      // Grid options
      const gridOptions = {
        columnDefs: [
          {
            field: 'name',
            filter: 'agTextColumnFilter',
            floatingFilter: true,
            headerName: 'Name'
          },
          {
            field: 'department',
            filter: 'agTextColumnFilter',
            floatingFilter: true,
            headerName: 'Department'
          },
          {
            field: 'salary',
            filter: 'agNumberColumnFilter',
            floatingFilter: true,
            headerName: 'Salary',
            valueFormatter: params => '$' + params.value.toLocaleString()
          },
          {
            field: 'age',
            filter: 'agNumberColumnFilter',
            floatingFilter: true,
            headerName: 'Age'
          },
          {
            field: 'startDate',
            filter: 'agDateColumnFilter',
            floatingFilter: true,
            headerName: 'Start Date',
            cellDataType: 'date'
          },
          {
            field: 'active',
            filter: 'agSetColumnFilter',
            floatingFilter: true,
            headerName: 'Active',
            cellRenderer: params => (params.value ? '‚úÖ Yes' : '‚ùå No')
          }
        ],
        rowData: rowData,
        defaultColDef: {
          flex: 1,
          sortable: true,
          resizable: true
        }
      }

      // Initialize grid
      const gridDiv = document.querySelector('#grid')
      agGrid.createGrid(gridDiv, gridOptions).then(grid => {
        window.gridApi = grid.gridApi
        initializeUrlSync()
      })

      let urlSync

      function initializeUrlSync() {
        const mode = document.querySelector('input[name="mode"]:checked').value
        const format = document.querySelector(
          'input[name="format"]:checked'
        ).value

        // Create URL sync with current settings
        const config =
          mode === 'grouped'
            ? {
                serialization: 'grouped',
                format: format,
                groupedParam: 'filters'
              }
            : {
                serialization: 'individual'
              }

        urlSync = AGGridUrlSync.createUrlSync(window.gridApi, config)

        // Apply filters from current URL if any
        urlSync.applyFromUrl(window.location.href)
      }

      // Event listeners for mode/format changes
      document.querySelectorAll('input[name="mode"]').forEach(radio => {
        radio.addEventListener('change', initializeUrlSync)
      })

      document.querySelectorAll('input[name="format"]').forEach(radio => {
        radio.addEventListener('change', initializeUrlSync)
      })

      function generateUrl() {
        if (!urlSync) return

        const url = urlSync.generateUrl(
          window.location.origin + window.location.pathname
        )
        document.getElementById('urlDisplay').textContent = url

        // Update browser URL
        window.history.replaceState({}, '', url)
      }

      function applyFromUrl() {
        const url = prompt(
          'Enter URL to apply filters from:',
          window.location.href
        )
        if (url && urlSync) {
          urlSync.applyFromUrl(url)
          generateUrl() // Update display
        }
      }

      function clearFilters() {
        if (urlSync) {
          urlSync.clearFilters()
          generateUrl() // Update display
        }
      }

      function addSampleFilters() {
        if (!urlSync) return

        // Add some sample filters to demonstrate
        urlSync.applyFilters({
          name: { filterType: 'text', type: 'contains', filter: 'John' },
          department: {
            filterType: 'text',
            type: 'equals',
            filter: 'Engineering'
          },
          salary: { filterType: 'number', type: 'greaterThan', filter: 80000 },
          age: {
            filterType: 'number',
            type: 'inRange',
            filter: 25,
            filterTo: 40
          },
          startDate: {
            filterType: 'date',
            type: 'dateAfter',
            filter: '2024-01-01'
          }
        })

        generateUrl() // Update display
      }

      function showFormats() {
        if (!urlSync) return

        let message = 'Current filters in different formats:\n\n'

        try {
          // Show all formats
          const formats = ['querystring', 'json', 'base64']
          formats.forEach(format => {
            if (urlSync.getFiltersAsFormat) {
              const formatted = urlSync.getFiltersAsFormat(format)
              message += `${format.toUpperCase()}:\n${formatted}\n\n`
            }
          })

          alert(message)
        } catch (error) {
          alert('Error showing formats: ' + error.message)
        }
      }

      // Initialize on page load
      window.addEventListener('load', () => {
        // Auto-apply any filters from URL on page load
        setTimeout(() => {
          const urlParams = new URLSearchParams(window.location.search)
          if (urlParams.toString()) {
            generateUrl() // Update display with current URL
          }
        }, 1000)
      })
    </script>
  </body>
</html>
